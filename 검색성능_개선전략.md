# ğŸš€ RAG ê²€ìƒ‰ ì„±ëŠ¥ ê°œì„  ì „ëµ

## ğŸ“Š í˜„ì¬ ì„±ëŠ¥ ë¶„ì„

### í˜„ì¬ ì§€í‘œ (ê°œì„  ëŒ€ìƒ)
- **Context Relevancy**: 0.288 (ëª©í‘œ: 0.5+)
- **Answer Relevancy**: 0.127 (ëª©í‘œ: 0.4+)  
- **ì „ì²´ ì ìˆ˜**: 0.616 (ëª©í‘œ: 0.75+)

### ìš°ìˆ˜í•œ ì§€í‘œ (ìœ ì§€)
- **Context Precision**: 1.000 âœ…
- **Context Recall**: 1.000 âœ…
- **Faithfulness**: 0.665 (ì–‘í˜¸)

---

## ğŸ¯ ê°œì„  ì „ëµ ë¡œë“œë§µ

## 1. ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ ìµœì í™” (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

### 1.1 í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„
```python
# í˜„ì¬: ìˆœìˆ˜ ë²¡í„° ê²€ìƒ‰
results = retriever.retrieve(query, top_k=3)

# ê°œì„ ì•ˆ: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° + BM25)
results = retriever.hybrid_retrieve(query, top_k=3)
```

**êµ¬í˜„ ê³„íš:**
- BM25 í‚¤ì›Œë“œ ê²€ìƒ‰ê³¼ ë²¡í„° ê²€ìƒ‰ ê²°í•©
- ê°€ì¤‘ì¹˜ ì¡°ì •: ë²¡í„° 70% + í‚¤ì›Œë“œ 30%
- ì˜ˆìƒ Context Relevancy í–¥ìƒ: 0.288 â†’ 0.45

### 1.2 ì¿¼ë¦¬ í™•ì¥ (Query Expansion)
```python
# ë™ì˜ì–´ ë° ê´€ë ¨ ìš©ì–´ ìë™ ì¶”ê°€
original_query = "What are human rights?"
expanded_query = "What are human rights? civil rights political rights fundamental freedoms"
```

**êµ¬í˜„ ë°©ë²•:**
- WordNet, ë„ë©”ì¸ íŠ¹í™” ì‹œì†ŒëŸ¬ìŠ¤ í™œìš©
- LLM ê¸°ë°˜ ì¿¼ë¦¬ í™•ì¥
- ì˜ˆìƒ ê°œì„ : Answer Relevancy +20%

### 1.3 Re-ranking ëª¨ë¸ ë„ì…
```python
# 1ì°¨: ë²¡í„° ê²€ìƒ‰ìœ¼ë¡œ í›„ë³´êµ° ì„ ë³„ (top_k=20)
candidates = vector_search(query, top_k=20)

# 2ì°¨: Cross-encoderë¡œ ì •ë°€ ì¬ì •ë ¬
reranked = cross_encoder_rerank(query, candidates, top_k=3)
```

**ì˜ˆìƒ íš¨ê³¼:**
- Context Relevancy: 0.288 â†’ 0.55
- Answer Relevancy: 0.127 â†’ 0.35

---

## 2. ì„ë² ë”© ëª¨ë¸ ê°œì„  (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

### 2.1 ë„ë©”ì¸ íŠ¹í™” ëª¨ë¸ í™œìš©
```python
# í˜„ì¬ ëª¨ë¸
model = "sentence-transformers/paraphrase-multilingual-mpnet-base-v2"

# ê°œì„  í›„ë³´ë“¤
candidates = [
    "sentence-transformers/all-MiniLM-L6-v2",  # ë¹ ë¥´ê³  íš¨ìœ¨ì 
    "intfloat/e5-large-v2",  # ìµœì‹  ê³ ì„±ëŠ¥ ëª¨ë¸
    "BAAI/bge-large-en-v1.5",  # MTEB ìƒìœ„ ëª¨ë¸
]
```

### 2.2 Fine-tuning ê²€í† 
- ì¸ê¶Œ ë„ë©”ì¸ ë°ì´í„°ë¡œ ëª¨ë¸ ë¯¸ì„¸ì¡°ì •
- Contrastive Learning ì ìš©
- ì˜ˆìƒ ì„ë² ë”© í’ˆì§ˆ í–¥ìƒ: 15-25%

---

## 3. ë°ì´í„° í’ˆì§ˆ ê°œì„  (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

### 3.1 ì²­í¬ í¬ê¸° ìµœì í™”
```python
# í˜„ì¬: ê³ ì • í¬ê¸° ì²­í¬
current_strategy = "fixed_size_chunking"

# ê°œì„ ì•ˆ: ì˜ë¯¸ ê¸°ë°˜ ì²­í¬
improved_strategy = "semantic_chunking"  # ë¬¸ë‹¨, ë¬¸ì¥ ë‹¨ìœ„
```

### 3.2 ë©”íƒ€ë°ì´í„° í™œìš© ê°•í™”
```python
# í˜„ì¬ ë©”íƒ€ë°ì´í„°
metadata = {
    "source_file": "amnesty_qa_generated",
    "chunk_type": "context"
}

# ê°œì„ ëœ ë©”íƒ€ë°ì´í„°
enhanced_metadata = {
    "source_file": "amnesty_qa_generated",
    "chunk_type": "context",
    "topic": "human_rights_principles",  # ì£¼ì œ ë¶„ë¥˜
    "difficulty": "basic",               # ë‚œì´ë„
    "keywords": ["universality", "equality"],  # í•µì‹¬ í‚¤ì›Œë“œ
    "section": "definitions"             # ì„¹ì…˜ ë¶„ë¥˜
}
```

---

## 4. ë‹µë³€ ìƒì„± ê°œì„  (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

### 4.1 í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
```python
# í˜„ì¬ í”„ë¡¬í”„íŠ¸ (ê¸°ë³¸)
current_prompt = "Answer the question based on the context."

# ê°œì„ ëœ í”„ë¡¬í”„íŠ¸
improved_prompt = """
Based on the provided context, answer the question with:
1. Direct answer to the question
2. Key supporting evidence from the context
3. Clear, concise language
4. Relevant examples when appropriate

Question: {question}
Context: {context}

Answer:
"""
```

### 4.2 ë‹µë³€ ê²€ì¦ ë‹¨ê³„ ì¶”ê°€
```python
# ìƒì„±ëœ ë‹µë³€ì˜ ê´€ë ¨ì„± ê²€ì¦
def validate_answer_relevancy(question, answer, context):
    relevancy_score = semantic_similarity(question, answer)
    factual_accuracy = check_facts_against_context(answer, context)
    return relevancy_score, factual_accuracy
```

---

## 5. í‰ê°€ ë° ëª¨ë‹ˆí„°ë§ (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

### 5.1 A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
```python
# ë‹¤ì–‘í•œ ê²€ìƒ‰ ì „ëµ ë¹„êµ
strategies = {
    "baseline": "pure_vector_search",
    "hybrid": "vector_plus_bm25",
    "reranked": "vector_plus_crossencoder",
    "expanded": "query_expansion_plus_vector"
}

# ì„±ëŠ¥ ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤
performance_matrix = compare_strategies(strategies, test_queries)
```

### 5.2 ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```python
# ì„±ëŠ¥ ì§€í‘œ ì¶”ì 
metrics_tracker = {
    "context_relevancy": [],
    "answer_relevancy": [], 
    "response_time": [],
    "user_satisfaction": []
}
```

---

## ğŸ› ï¸ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1 (ì¦‰ì‹œ êµ¬í˜„ - 1ì£¼)
1. **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ í™œì„±í™”**
   - `retriever.py`ì˜ `hybrid_retrieve` ë©”ì„œë“œ í™œìš©
   - BM25 + ë²¡í„° ê²€ìƒ‰ ê²°í•©
   - ì˜ˆìƒ ê°œì„ : Context Relevancy +50%

2. **í•„í„° ì¡°ê±´ ìµœì í™”**
   - í˜„ì¬ ë°ì´í„°ì— ë§ëŠ” í•„í„° ì¡°ê±´ ì„¤ì •
   - `chunk_type="context"` í™œìš©

### Phase 2 (ë‹¨ê¸° - 2-3ì£¼)
1. **Re-ranking ëª¨ë¸ êµ¬í˜„**
   - Cross-encoder ê¸°ë°˜ ì¬ì •ë ¬
   - Top-20 â†’ Top-3 ì •ë°€ ì„ ë³„

2. **ì¿¼ë¦¬ í™•ì¥ êµ¬í˜„**
   - ë™ì˜ì–´ ë° ê´€ë ¨ì–´ ìë™ ì¶”ê°€
   - LLM ê¸°ë°˜ ì¿¼ë¦¬ ê°œì„ 

### Phase 3 (ì¤‘ê¸° - 1-2ê°œì›”)
1. **ì„ë² ë”© ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ**
   - ìµœì‹  ê³ ì„±ëŠ¥ ëª¨ë¸ í…ŒìŠ¤íŠ¸
   - ë„ë©”ì¸ íŠ¹í™” Fine-tuning

2. **ë°ì´í„° í’ˆì§ˆ ê°œì„ **
   - ì˜ë¯¸ ê¸°ë°˜ ì²­í‚¹
   - ë©”íƒ€ë°ì´í„° ê°•í™”

---

## ğŸ“ˆ ì˜ˆìƒ ì„±ëŠ¥ ê°œì„ 

### ëª©í‘œ ì§€í‘œ (3ê°œì›” í›„)
| ì§€í‘œ | í˜„ì¬ | ëª©í‘œ | ê°œì„ ìœ¨ |
|------|------|------|--------|
| Context Relevancy | 0.288 | 0.550 | +91% |
| Answer Relevancy | 0.127 | 0.400 | +215% |
| Faithfulness | 0.665 | 0.750 | +13% |
| **Overall Score** | **0.616** | **0.750** | **+22%** |

### ë‹¨ê³„ë³„ ê°œì„  ì˜ˆìƒ
- **Phase 1**: 0.616 â†’ 0.685 (+11%)
- **Phase 2**: 0.685 â†’ 0.720 (+5%)  
- **Phase 3**: 0.720 â†’ 0.750 (+4%)

---

## ğŸš€ ë¹ ë¥¸ ì‹¤í–‰ ê°€ì´ë“œ

### ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ê°œì„ 
```python
# 1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ í™œì„±í™”
config.retrieval['hybrid_search'] = True

# 2. ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ ì¦ê°€ (ì¬ì •ë ¬ìš©)
config.retrieval['top_k'] = 10  # ê¸°ì¡´ 3 â†’ 10

# 3. ì„ê³„ê°’ ì¡°ì •
config.retrieval['similarity_threshold'] = 0.3  # ê¸°ì¡´ 0.5 â†’ 0.3

# 4. ì¿¼ë¦¬ ìµœì í™” í™œì„±í™”
results = retriever.retrieve(
    query, 
    enable_query_optimization=True,
    force_filter_expr=None
)
```

ì´ ì „ëµì„ ë‹¨ê³„ì ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ RAG ì‹œìŠ¤í…œì˜ ê²€ìƒ‰ ì„±ëŠ¥ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
